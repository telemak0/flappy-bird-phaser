/*! For license information please see main.d24b279d41ed2131b07f.bundle.js.LICENSE.txt */
(()=>{var t,e={484:(t,e,s)=>{"use strict";s(260);class i{constructor(t,e,s,i={}){this.input_nodes=t,this.hidden_nodes=e,this.output_nodes=s,i instanceof tf.Sequential?this.model=i:this.model=this.createModel()}copy(){return tf.tidy((()=>{const t=this.createModel(),e=this.model.getWeights(),s=[];for(let t=0;t<e.length;t++)s[t]=e[t].clone();return t.setWeights(s),new i(this.input_nodes,this.hidden_nodes,this.output_nodes,t)}))}mutate(t){tf.tidy((()=>{const e=this.model.getWeights(),s=[];for(let i=0;i<e.length;i++){let o=e[i],a=e[i].shape,r=o.dataSync().slice();for(let e=0;e<r.length;e++)if(Phaser.Math.FloatBetween(.01,1)<t){let t=r[e];r[e]=t+Phaser.Math.FloatBetween(-1,1)}let h=tf.tensor(r,a);s[i]=h}this.model.setWeights(s)}))}dispose(){this.model.dispose()}predict(t){return tf.tidy((()=>{const e=tf.tensor2d([t]);return this.model.predict(e).dataSync()}))}createModel(){const t=tf.sequential(),e=tf.layers.dense({units:this.hidden_nodes,inputShape:[this.input_nodes],activation:"relu"});t.add(e);const s=tf.layers.dense({units:this.output_nodes,activation:"sigmoid"});return t.add(s),t}}class o extends Phaser.Physics.Arcade.Sprite{constructor(t,e){super(t,50,300,"bird"),this.mutateRate=.05,this.score=0,this.fitness=0,e instanceof i?(this.brain=e.copy(),this.brain.mutate(this.mutateRate)):this.brain=new i(8,16,1)}copy(t){return new o(t,this.brain)}show(){image(birdImg,this.x,this.y)}chooseAction(t){let e=null,s=null,i=1/0;for(let o=0;o<t.length;o++){let a=t[o].top.x+t[o].top.width/2-this.x;a>0&&a<i&&(i=a,e=t[o],s=t[o+1])}let{width:o,height:a}=this.scene.sys.game.canvas;if(null!=e){let t=[];t[0]=this.map(e.top.x,this.body.x,o,0,1),t[1]=this.map(e.top.y+250,0,a,0,1),t[2]=this.map(e.bottom.y-380,0,a,0,1),t[3]=this.map(s.top.x,this.body.x,o,0,1),t[4]=this.map(s.top.y+250,0,a,0,1),t[5]=this.map(s.bottom.y-380,0,a,0,1),t[6]=this.map(this.y,0,a,0,1),t[7]=this.map(this.body.velocity.y,-450,1e3,0,1),this.brain.predict(t)[0]>.5&&this.jump()}}jump(){this.setVelocityY(-450)}bottomTopCollision(){return this.y<0||this.y>800}update(){}map(t,e,s,i,o){return(t-e)/(s-e)*(o-i)+i}}class a{constructor(t,e){this.top=t.add.image(e,-200,"pipeUp").setScale(2),this.bottom=t.add.image(e,600,"pipeDown").setScale(2);const s=Phaser.Math.Between(100,440);this.top.y=this.top.y+s,this.bottom.y=this.bottom.y+s,t.physics.world.enable([this.top,this.bottom]),this.top.body.setVelocity(-600,0).setAllowGravity(!1),this.bottom.body.setVelocity(-600,0).setAllowGravity(!1)}checkCollision(t){let e=this.top.getBounds(),s=this.bottom.getBounds(),i=t.getBounds();return Phaser.Geom.Intersects.RectangleToRectangle(e,i)||Phaser.Geom.Intersects.RectangleToRectangle(s,i)}show(){}update(){}checkOffScreen(){return this.top.x<-40}destroy(){this.top.destroy(),this.bottom.destroy()}}class r extends Phaser.Scene{constructor(){super(),this.totalPopulation=1,this.aliveBirds=[],this.allBirds=[],this.pipes=[],this.generation=1,this.score=0,this.topScore=0}preload(){this.load.setPath("assets/"),this.load.image("background","bg.png"),this.load.image("ground","ground.png"),this.load.image("pipeUp","pipeUp.png"),this.load.image("pipeDown","pipeDown.png"),this.load.spritesheet("bird","bird.png",{frameWidth:34,frameHeight:24,endFrame:2}),this.load.setPath("assets/fonts/"),this.load.bitmapFont("flappyfont","flappyfont.png","flappyfont.xml")}create(){let t=this.game.config.width/2,e=this.game.config.height/2;this.background=this.add.image(t,e,"background").setOrigin(.5,.5),this.background.setScale(2),this.ground=this.add.image(t,810,"ground").setOrigin(.5,0).setScale(2,2),this.labelScore=this.add.bitmapText(10,10,"flappyfont",this.score,36).setDepth(1),this.add.existing(this.labelScore),this.labelTop=this.add.bitmapText(320,10,"flappyfont","Record: "+this.topScore,36).setDepth(1),this.add.existing(this.labelTop),this.anims.create({key:"fly",frames:this.anims.generateFrameNumbers("bird",{start:0,end:2}),frameRate:10,repeat:-1}),this.createNextGeneration(),this.createPipe()}update(){this.input.on("pointerdown",(function(){var t;null===(t=this.aliveBirds[0])||void 0===t||t.jump()}),this);for(let t=this.pipes.length-1;t>=0;t--)this.pipes[t].checkOffScreen()&&(this.pipes.splice(t,1)[0].destroy(),this.score++);for(let t=this.aliveBirds.length-1;t>=0;t--){let e=this.aliveBirds[t];e.update();for(let s=0;s<this.pipes.length;s++)if(this.pipes[s].checkCollision(e)){e.destroy(),this.aliveBirds.splice(t,1);break}e.bottomTopCollision()&&(e.destroy(),this.aliveBirds.splice(t,1))}0==this.aliveBirds.length?(this.generation++,this.createNextGeneration(),this.resetPipes()):(this.labelScore.setText(this.score),this.createPipe())}createNextGeneration(){this.allBirds=[];for(let t=0;t<this.totalPopulation;t++){let e=new o(this);this.aliveBirds[t]=e,this.allBirds[t]=e,e.setScale(2),this.physics.add.existing(e,!1),this.add.existing(e),e.anims.play("fly")}this.topScore=this.score>this.topScore?this.score:this.topScore,this.labelTop.setText("Record: "+this.topScore),this.score=0}createPipe(){for(;this.pipes.length<5;){let t=this.pipes.slice(-1).pop(),e=t?t.top.x+600:800;this.pipes.push(new a(this,e))}}resetPipes(){for(let t=0;t<this.pipes.length;t++)this.pipes[t].destroy();this.pipes=[],this.createPipe()}restartGame(){this.scene.restart()}}const h={type:Phaser.AUTO,backgroundColor:"#ffffff",scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:540,height:960},scene:[r],physics:{default:"arcade",arcade:{debug:!1,gravity:{y:1200}}}};window.addEventListener("load",(()=>{new Phaser.Game(h)}))},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},s={};function i(t){var o=s[t];if(void 0!==o)return o.exports;var a=s[t]={exports:{}};return e[t].call(a.exports,a,a.exports,i),a.exports}i.m=e,t=[],i.O=(e,s,o,a)=>{if(!s){var r=1/0;for(l=0;l<t.length;l++){for(var[s,o,a]=t[l],h=!0,n=0;n<s.length;n++)(!1&a||r>=a)&&Object.keys(i.O).every((t=>i.O[t](s[n])))?s.splice(n--,1):(h=!1,a<r&&(r=a));if(h){t.splice(l--,1);var p=o();void 0!==p&&(e=p)}}return e}a=a||0;for(var l=t.length;l>0&&t[l-1][2]>a;l--)t[l]=t[l-1];t[l]=[s,o,a]},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={179:0};i.O.j=e=>0===t[e];var e=(e,s)=>{var o,a,[r,h,n]=s,p=0;if(r.some((e=>0!==t[e]))){for(o in h)i.o(h,o)&&(i.m[o]=h[o]);if(n)var l=n(i)}for(e&&e(s);p<r.length;p++)a=r[p],i.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return i.O(l)},s=self.webpackChunkphaser_project_template=self.webpackChunkphaser_project_template||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})(),i.O(void 0,[216],(()=>i(484)));var o=i.O(void 0,[216],(()=>i(204)));o=i.O(o)})();